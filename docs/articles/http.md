#### é¢˜ç›®ï¼šUDP ä¸ TCP çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

#### ORTT? HTTPSæ¡æ‰‹ï¼Ÿ

#### å‚è€ƒé“¾æ¥
[å…³äºHttpåè®®ï¼Œä½ å¿…é¡»è¦çŸ¥é“çš„](https://segmentfault.com/a/1190000016751071)  
[ä¸€æ–‡è¯»æ‡‚ HTTP/2 åŠ HTTP/3 ç‰¹æ€§](https://blog.fundebug.com/2019/03/07/understand-http2-and-http3/)  
[è§£å¯†HTTP/2ä¸HTTP/3 çš„æ–°ç‰¹æ€§](https://segmentfault.com/a/1190000020714686)  
[httpsåˆ°åº•æ˜¯å¦‚ä½•é˜²ç¯¡æ”¹çš„ï¼Ÿ](https://juejin.cn/post/6845166890675863559)  
[httpsè¯¦ç»†æ¡æ‰‹è¿‡ç¨‹](https://juejin.cn/post/6847902219745181709#comment)

------
#### ç½‘ç»œé€šä¿¡

OSIæ¨¡å‹ï¼šç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚ã€ä¼ è¾“å±‚(TCP/UDP)ã€ä¼šè¯å±‚ã€è¡¨ç¤ºå±‚ã€åº”ç”¨å±‚

### TCP åŸºäºè¿æ¥

å¤´éƒ¨ï¼š
1. Sequence number åºåˆ—å·ï¼Œä¿è¯æŠ¥æ–‡æœ‰åºï¼Œå¯¹ç«¯ç»„è£…æ•°æ®åŒ…ä½¿ç”¨
2. Acknowledgement Number æ¥æ”¶ç«¯å¸Œæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªå­—èŠ‚åºå·ï¼ŒåŒæ—¶è¡¨ç¤ºå·²æ”¶åˆ°ä¸Šä¸ªåºå·çš„æ•°æ®
3. Window Size çª—å£å¤§å°ï¼Œè¿˜èƒ½æ¥æ”¶å¤šå°‘å­—èŠ‚çš„æ•°æ®ï¼Œç”¨äºæµé‡æ§åˆ¶
4. æ ‡è¯†ç¬¦
    - SYN
        - SYN=1ï¼ŒACK=0ï¼Œè¡¨ç¤ºå½“å‰æŠ¥æ–‡æ®µæ˜¯ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚
        - SYN=1ï¼ŒACK=1ï¼Œè¡¨ç¤ºå½“å‰æŠ¥æ–‡æ®µæ˜¯ä¸€ä¸ªåŒæ„å»ºç«‹è¿æ¥çš„åº”ç­”æŠ¥æ–‡ã€‚
    - ACK=1ï¼Œè¡¨ç¤ºç¡®è®¤åºå·å­—æ®µæœ‰æ•ˆï¼Œå»ºç«‹è¿æ¥åæ‰€æœ‰æŠ¥æ–‡çš„ ACK éƒ½è¦ç½®ä¸º1ã€‚
    - FIN=1ï¼Œè¡¨ç¤ºæ­¤æŠ¥æ–‡æ®µæ˜¯ä¸€ä¸ªé‡Šæ”¾è¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚
    - URG=1ï¼Œè¡¨ç¤ºæ•°æ®åŒ…åŒ…å«ç´§æ€¥ä¿¡æ¯å±äºé«˜ä¼˜å…ˆçº§æ•°æ®æŠ¥æ–‡ï¼Œæ­¤æ—¶ç´§æ€¥æŒ‡é’ˆæœ‰æ•ˆï¼Œç´§æ€¥æ•°æ®ä½äºæ•°æ®éƒ¨åˆ†æœ€å‰é¢ï¼Œç´§æ€¥æŒ‡é’ˆæ ‡æ˜ç´§æ€¥æ•°æ®çš„å°¾éƒ¨ã€‚
    - PSH=1ï¼Œè¡¨ç¤ºæ¥æ”¶ç«¯åº”è¯¥ç«‹å³å°†æ•°æ® push ç»™åº”ç”¨å±‚ï¼Œè€Œä¸æ˜¯ç­‰åˆ°ç¼“å†²åŒºæ»¡åå†æäº¤ã€‚
    - RST=1ï¼Œè¡¨ç¤ºå½“å‰è¿æ¥å‡ºç°é—®é¢˜ï¼Œå¯èƒ½éœ€è¦é‡æ–°å»ºç«‹è¿æ¥ï¼Œä¹Ÿå¯ä»¥ç”¨äºæ‹’ç»éæ³•çš„æŠ¥æ–‡æ®µå’Œæ‹’ç»è¿æ¥è¯·æ±‚ã€‚

::: details ä¸‰æ¬¡æ¡æ‰‹
1. å®¢æˆ·ç«¯å‘é€ `SYN` åŒ…åˆ°æœåŠ¡ç«¯å¹¶è¿›å…¥ `SYN-SEND` çŠ¶æ€ï¼ˆç¬¬ä¸€æ¬¡ğŸ¤ï¼‰
2. æœåŠ¡ç«¯åŒæ„è¿æ¥åˆ™å›å¤ `SYN+ACK` åŒ…å¹¶è¿›å…¥ `SYN-RECEIVED` çŠ¶æ€ï¼ˆç¬¬äºŒæ¬¡ğŸ¤ï¼‰
3. å®¢æˆ·ç«¯æ”¶åˆ°åå›å¤ `ACK` åŒ…å¹¶è¿›å…¥ `ESTABLISHED` çŠ¶æ€ï¼ˆç¬¬ä¸‰æ¬¡ğŸ¤ï¼‰
4. æœåŠ¡ç«¯æ”¶åˆ°åè¿›å…¥ `ESTABLISHED` çŠ¶æ€ï¼Œå»ºç«‹è¿æ¥

- ç¬¬ä¸‰æ¬¡æ¡æ‰‹çš„å¿…è¦æ€§ï¼Ÿ
    - ä¸ºäº†é˜²æ­¢å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡çªç„¶ä¼ é€åˆ°æœåŠ¡ç«¯å¼•èµ·é”™è¯¯ï¼Œè§£å†³ç½‘ç»œä¿¡é“ä¸å¯é çš„é—®é¢˜ã€‚
- è¿æ¥è¿‡ç¨‹ä¸­ä»»æ„ç«¯æ‰çº¿ TCP éƒ½ä¼šé‡å‘ SYN åŒ…ï¼Œä¸€èˆ¬ä¼šé‡è¯•5æ¬¡ã€‚
:::

::: details ä¼ è¾“ç¡®è®¤
- ä¸¢åŒ…é—®é¢˜ & ä¹±åºé—®é¢˜
    - TCPåè®®ä¸ºæ¯ä¸€ä¸ªè¿æ¥å»ºç«‹äº†å‘é€ç¼“å†²åŒºï¼ˆå‘é€çª—å£ï¼‰ï¼Œå»ºç«‹è¿æ¥åçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åºåˆ—å·ä¸º0ï¼Œåé¢æ¯ä¸ªå­—èŠ‚çš„åºåˆ—å·+1ï¼Œå‘é€æ•°æ®æ—¶ä»ç¼“å†²åŒºå–å‡ºä¸€éƒ¨åˆ†æ•°æ®ç»„æˆå‘é€æŠ¥æ–‡ï¼Œåœ¨TCPåè®®å¤´ä¸­ä¼šé™„å¸¦â€åºåˆ—å·å’Œé•¿åº¦â€œï¼Œæ¥å—ç«¯æ”¶åˆ°åå›å¤çš„ ACK åŒ…åŒ…å«äº†æ¥æ”¶çš„â€åºåˆ—å·å’Œé•¿åº¦â€œä¹Ÿå°±æ˜¯ä¸‹ä¸€åŒ…æ•°æ®çš„èµ·å§‹åºåˆ—å·ã€‚
    - æ¥æ”¶ç«¯æ”¶åˆ°åæ ¹æ®â€åºåˆ—å·å’Œé•¿åº¦â€œé‡ç»„æ•°æ®åŒ…ï¼Œå¦‚æœæœ‰ä¸¢å¤±å¯ä»¥é‡å‘ä¸€ä¸ª ACK åŒ…åˆ°å‘é€ç«¯è¦æ±‚å‘é€ç«¯é‡å‘ã€‚
- ARQ åè®®ï¼Œè¶…æ—¶é‡ä¼ æœºåˆ¶ & æ»‘åŠ¨çª—å£
    - åœæ­¢ç­‰å¾… ARQï¼ˆæ•ˆç‡ä½ï¼Œæ¯æ¬¡éƒ½éœ€è¦ç­‰å¾…ï¼‰
        - åªè¦ A å‘ B å‘é€ä¸€æ®µæŠ¥æ–‡ï¼Œéƒ½è¦æš‚åœå‘é€å¹¶å¯åŠ¨ä¸€ä¸ªå®šæ—¶å™¨ï¼Œç­‰å¾…å¯¹ç«¯å›åº”ï¼Œåœ¨å®šæ—¶å™¨æ—¶é—´å†…æ¥æ”¶åˆ°å¯¹ç«¯åº”ç­”å°±å–æ¶ˆå®šæ—¶å™¨å¹¶å‘é€ä¸‹ä¸€æ®µæŠ¥æ–‡ã€‚æœªæ¥æ”¶åˆ°å°±é‡å‘ä¸¢å¤±çš„æ•°æ®åˆ°å¯¹ç«¯ï¼Œä¼ è¾“è¿‡ç¨‹ä¸­ä¹Ÿå¯èƒ½å‡ºé”™é‚£ä¹ˆå¯¹ç«¯ä¹Ÿå¯ä»¥è¦æ±‚å‘é€ç«¯é‡å‘æŠ¥æ–‡ã€‚å¯¹ç«¯çš„åº”ç­”æŠ¥æ–‡ä¹Ÿå¯èƒ½å‡ºç°ä¸¢å¤±æˆ–è¶…æ—¶ï¼Œå‘é€ç«¯åŒæ ·ä¼šé‡å‘æŠ¥æ–‡ï¼Œå¯¹ç«¯æ¥æ”¶åˆ°çš„å¦‚æœæ˜¯ç›¸åŒåºå·çš„æŠ¥æ–‡åˆ™ç›´æ¥ä¸¢å¼ƒå¹¶é‡å‘åº”ç­”æŠ¥æ–‡ï¼Œç›´åˆ°æ¥æ”¶åˆ°å‘é€ç«¯çš„ä¸‹ä¸€åºå·çš„æŠ¥æ–‡ã€‚å‘é€ç«¯åŒæ ·çš„å¦‚æœæ¥å—åˆ°å·²ç»æ”¶åˆ°è¿‡çš„åº”ç­”æŠ¥æ–‡å°±ç›´æ¥ä¸¢å¼ƒã€‚
    - è¿ç»­ ARQ
        - å‘é€ç«¯æ‹¥æœ‰ä¸€ä¸ªå‘é€çª—å£ï¼Œåœ¨æ²¡æœ‰æ”¶åˆ°åº”ç­”æŠ¥æ–‡çš„æƒ…å†µä¸‹å¯ä»¥æŒç»­ä¸æ–­çš„å‘é€çª—å£å†…çš„æ•°æ®ï¼Œæ¥æ”¶ç«¯ä¼šè¿ç»­ä¸æ–­çš„æ”¶åˆ°æŠ¥æ–‡ï¼Œæ¥æ”¶ç«¯å¯ä»¥åœ¨æ¥å—å¤šä¸ªæŠ¥æ–‡ä¹‹åç»Ÿä¸€åº”ç­”ï¼Œå›å¤çš„åº”ç­”æŠ¥æ–‡ä¸­çš„ ACK å¯ä»¥å‘Šè¯‰å‘é€ç«¯è¯¥åºå·å‰çš„æ•°æ®å·²ç»å…¨éƒ¨æ”¶åˆ°ã€‚ä½†æ˜¯å¼Šç«¯æ˜¯è‚¯èƒ½ 5 å’Œ 7 æ”¶åˆ°äº†ä½†æ˜¯6æ²¡æ”¶åˆ°ï¼Œå›å¤æŠ¥æ–‡åªèƒ½æ˜¯ 6ï¼Œå¯¼è‡´7çš„é‡å¤ä¼ è¾“ã€‚
        - å‘é€ç«¯çª—å£åŒ…å« `å·²å‘é€ä½†æœªæ”¶åˆ°åº”ç­”` çš„æ•°æ®å’Œ `å¯ä»¥å‘é€ä½†æ˜¯æœªå‘é€` çš„æ•°æ®ã€‚
        - æ»‘åŠ¨çª—å£ï¼Œå‘é€ç«¯çª—å£å¤§å°ä¼šæ ¹æ®æ¥æ”¶ç«¯çš„çª—å£å¤§å°è¿›è¡Œå˜åŒ–ï¼ŒåŒ…å«å¯¹ç½‘ç»œçŠ¶å†µçš„å¤„ç†ã€‚
        - Zeroçª—å£ï¼Œå‘é€æ•°æ®æ—¶é‡åˆ°å¯¹ç«¯å›å¤çª—å£å¤§å°0æ—¶ï¼Œå°±ä¼šæš‚åœå‘é€æ•°æ®ï¼Œå¯ç”¨ persistent timerï¼Œä¼šä¸æ–­å‘é€è¯·æ±‚è¦æ±‚å¯¹ç«¯å‘ŠçŸ¥çª—å£å¤§å°ï¼Œè¶…å‡ºä¸€å®šæ¬¡æ•°åå¯èƒ½ä¼šä¸­æ–­ TCP è¿æ¥ã€‚
- æ‹¥å¡å¤„ç†
    - æµé‡æ§åˆ¶ä¿è¯æ¥æ”¶ç«¯æ¥å¾—åŠæ¥å—æ•°æ®ï¼Œæ‹¥å¡å¤„ç†ä½œç”¨äºç½‘ç»œé˜²æ­¢è¿‡å¤šçš„æ•°æ®æ‹¥å¡ç½‘ç»œã€‚
    - RTT è¡¨ç¤ºå‘é€ç«¯å‘å‡ºæ•°æ®åˆ°æ¥æ”¶åˆ°å¯¹ç«¯æ•°æ®æ‰€éœ€çš„æ—¶é—´ã€‚
    - æ…¢å¼€å§‹
        1. è¿æ¥åˆå§‹è®¾ç½®æ‹¥å¡çª—å£ï¼ˆCongestion Windowï¼‰ ä¸º 1 MSS(Maximum Segment Size)ï¼ˆä¸€ä¸ªåˆ†æ®µçš„æœ€å¤§æ•°æ®é‡ï¼‰ã€‚
        2. æ¯è¿‡ä¸€ä¸ª RTT å°±å°†çª—å£å¤§å°ä¹˜äºŒã€‚
        3. æœ‰ä¸€ä¸ªé˜ˆå€¼é™åˆ¶ï¼Œå½“çª—å£å¤§å°å¤§äºé˜ˆå€¼æ—¶å°±ä¼šå¯åŠ¨æ‹¥å¡é¿å…ç®—æ³•ã€‚
    - æ‹¥å¡é¿å…
        1. æ¯è¿‡ä¸€ä¸ª RTT çª—å£å¤§å°åªåŠ ä¸€ã€‚
        2. ç½‘ç»œæ‹¥å¡åå°†é˜ˆå€¼è®¾ä¸ºå½“å‰æ‹¥å¡çª—å£çš„ä¸€åŠï¼Œå°†æ‹¥å¡çª—å£è®¾ä¸º 1 MSSï¼Œå¯åŠ¨æ‹¥å¡é¿å…ç®—æ³•
    - å¿«é€Ÿé‡ä¼ 
    - å¿«é€Ÿæ¢å¤
:::

::: details å››æ¬¡æŒ¥æ‰‹
1. å®¢æˆ·ç«¯å‘é€ FIN åŒ…ï¼Œè¡¨ç¤ºè¦å…³é—­è¿æ¥å¹¶è¿›å…¥ FIN-WAIT-1 çŠ¶æ€ï¼ˆç¬¬ä¸€æ¬¡ğŸ‘‹ï¼‰
2. æœåŠ¡ç«¯æ”¶åˆ°åé€šçŸ¥åº”ç”¨å±‚è¦é‡Šæ”¾ TCP è¿æ¥å¹¶å›å¤å®¢æˆ·ç«¯ ACK åŒ…å¹¶è¿›å…¥ CLOSED-WAIT çŠ¶æ€ï¼ˆç¬¬äºŒæ¬¡ğŸ‘‹ï¼‰
3. å®¢æˆ·ç«¯æ”¶åˆ° ACK åŒ…å¹¶è¿›å…¥ FIN-WAIT-2 çŠ¶æ€
4. æœåŠ¡ç«¯ç¡®è®¤æ•°æ®å·²å‘é€å®Œæ¯•åå‘é€ FIN åŒ…å¹¶è¿›å…¥ LAST-ACK çŠ¶æ€ï¼ˆç¬¬ä¸‰æ¬¡ğŸ‘‹ï¼‰
5. å®¢æˆ·ç«¯æ”¶åˆ°åå›å¤ ACK åŒ…å¹¶è¿›å…¥ TIME-WAIT çŠ¶æ€ç»è¿‡è¶…æ—¶æ—¶é—´åå…³é—­è¿æ¥å¹¶è¿›å…¥ CLOSED çŠ¶æ€ï¼ˆç¬¬å››æ¬¡ğŸ‘‹ï¼‰
6. æœåŠ¡ç«¯æ”¶åˆ° ACK åŒ…åç«‹å³è¿›å…¥ CLOSED çŠ¶æ€

- ä¸ºä»€ä¹ˆéœ€è¦ TIME-WAIT çŠ¶æ€ï¼Ÿ
    - ä¸ºäº†ä¿è¯å¯¹ç«¯æ”¶åˆ°å‘é€çš„ ACK åŒ…ï¼Œå¦‚æœæ²¡æœ‰è¶…æ—¶æ—¶é—´ç›´æ¥å…³é—­è¿æ¥ï¼Œå½“ ACK åŒ…ä¸¢å¤±æ—¶å¯¹ç«¯å°†ä¿æŒ LAST-ACK çŠ¶æ€æ— æ³•å…³é—­è¿æ¥ã€‚æœ‰è¶…æ—¶æ—¶é—´æ—¶å¯¹ç«¯å¦‚æœæœªæ¥æ”¶åˆ° ACK åŒ…ä¼šé‡å‘ FIN åŒ…ï¼Œå®¢æˆ·ç«¯å“åº”åé‡å‘ ACK åŒ…åŒæ—¶åˆ·æ–°è¶…æ—¶æ—¶é—´è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
:::

### UDP åŸºäºéè¿æ¥

1. ç¨³å®šæ€§å·®ï¼Œå¯èƒ½é€ æˆä¸¢åŒ…
2. é€Ÿåº¦å¿«
3. éš§é“ç½‘ç»œï¼Œå¦‚ VPN

### HTTP/1.1

1. è¿æ¥æ— æ³•å¤ç”¨ï¼šæ¡æ‰‹è¿‡ç¨‹åœ¨é«˜å»¶è¿Ÿåœºæ™¯ä¸‹å½±å“è¾ƒå¤§ï¼Œæ…¢å¯åŠ¨å¯¹å°æ–‡ä»¶å¤§æ‰¹é‡è¯·æ±‚å½±å“è¾ƒå¤§(è¾¾ä¸åˆ°æœ€å¤§çª—å£å°±ä¼šç»ˆæ­¢)
2. å¯¹å¤´é˜»å¡ï¼š
    - http1.0(çŸ­è¿æ¥): ä¸‹ä¸ªè¯·æ±‚å¿…é¡»åœ¨ä¸Šä¸ªè¯·æ±‚è¿”å›åæ‰èƒ½å‘å‡ºï¼Œå½“http1.1ä¸‹ `Connection` è¢«è®¾ç½®ä¸º `close` æ—¶ä¹Ÿä¼šç”¨åˆ°è¿™ä¸ªæ¨¡å‹ï¼Œè®¾ç½® `Connection` ä¸º `retry-afte`æ—¶å¯ä»¥ä¿æŒé•¿è¿æ¥
    - http1.1(é»˜è®¤é•¿è¿æ¥æ¨¡å‹ keep-alive: æŒ‡å®šä¸€ä¸ªæœ€å°çš„è¿æ¥ä¿æŒæ—¶é—´): æµè§ˆå™¨å¤ç”¨åŒä¸€æ¬¡è¿æ¥å‘é€å¤šæ¬¡è¯·æ±‚ï¼Œä½†ä¾ç„¶éœ€è¦ä¸Šä¸€ä¸ªè¿”å›åæ‰å‘å‡ºï¼Œé•¿è¿æ¥çš„ç¼ºç‚¹æ˜¯å³ä½¿åœ¨ç©ºé—²çŠ¶æ€ä¹Ÿè¿˜æ˜¯ä¼šæ¶ˆè€—æœåŠ¡å™¨èµ„æºã€‚
    - http1.1(æµæ°´çº¿æ¨¡å‹): æµè§ˆå™¨å¯ä»¥ä¸€æ¬¡å‘é€å¤šä¸ªè¯·æ±‚(åŒåŸŸå)ï¼Œä½†æ˜¯è¿”å›å€¼æ˜¯æŒ‰æ¬¡åºçš„ï¼Œå¦‚æœå‰é¢çš„è€—æ—¶æ¯”è¾ƒä¹…ï¼Œåé¢çš„è¯·æ±‚å³ä½¿å¤„ç†å®Œä¹Ÿè¦ç­‰å¾…å‰é¢çš„è¿”å›ã€‚æµæ°´çº¿å·²ç»è¢«æ›´å¥½çš„ç®—æ³•ç»™ä»£æ›¿ï¼Œå¦‚ `multiplexing`ï¼Œå·²ç»ç”¨åœ¨ `HTTP/2`ã€‚
3. åŸŸååˆ†ç‰‡ï¼šåŸŸååˆ†ç‰‡ç”šè‡³ä¼šå½±å“æ€§èƒ½ã€‚å¤§å¤šæ•° HTTP/2 çš„å®ç°è¿˜ä¼šä½¿ç”¨ä¸€ç§ç§°ä½œè¿æ¥å‡èšçš„æŠ€æœ¯å»å°è¯•åˆå¹¶è¢«åˆ†ç‰‡çš„åŸŸåã€‚
4. headeré‡Œæºå¸¦çš„å†…å®¹è¿‡å¤§ï¼Œéƒ½æ˜¯æ–‡æœ¬æ ¼å¼
![è¿æ¥ç®¡ç†æ¨¡å‹](../../assets/img/HTTP1_x_Connections.png)

### HTTP/2

[å¯¹æ¯”http1](https://http2.akamai.com/demo)

1. äºŒè¿›åˆ¶åˆ†å¸§ï¼š
    - æµï¼šæµæ˜¯è¿æ¥ä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¿¡é“ï¼Œå¯ä»¥æ‰¿è½½åŒå‘çš„æ¶ˆæ¯ï¼›æ¯ä¸ªæµéƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°æ ‡è¯†ç¬¦ï¼ˆ1ã€2â€¦Nï¼‰ï¼›
    - æ¶ˆæ¯ï¼šæ˜¯æŒ‡é€»è¾‘ä¸Šçš„ HTTP æ¶ˆæ¯ï¼Œæ¯”å¦‚è¯·æ±‚ã€å“åº”ç­‰ï¼Œç”±ä¸€æˆ–å¤šä¸ªå¸§ç»„æˆã€‚
    - å¸§ï¼šæ˜¯HTTP 2.0 é€šä¿¡çš„æœ€å°å•ä½ï¼Œæ¯ä¸ªå¸§åŒ…å«å¸§é¦–éƒ¨ï¼Œè‡³å°‘ä¹Ÿä¼šæ ‡è¯†å‡ºå½“å‰å¸§æ‰€å±çš„æµï¼Œæ‰¿è½½ç€ç‰¹å®šç±»å‹çš„æ•°æ®ï¼Œå¦‚ HTTP é¦–éƒ¨ã€è´Ÿè·ï¼Œç­‰ç­‰
    - åŒåŸŸåä¸‹çš„æ‰€æœ‰é€šä¿¡éƒ½åœ¨`å•ä¸ªè¿æ¥`å®Œæˆï¼Œè¯¥è¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„`åŒå‘æ•°æ®æµ`ï¼Œæ¯ä¸ªæ•°æ®æµéƒ½æ˜¯ä»¥`æ¶ˆæ¯`çš„å½¢å¼å‘é€ä¼ è¾“ï¼Œæ¶ˆæ¯ç”±`ä¸€ä¸ªæˆ–å¤šä¸ªå¸§`ç»„æˆï¼Œå¸§æ˜¯ä¹±åºçš„ï¼Œå¯ä»¥é€šè¿‡æºå¸¦çš„æµæ ‡è¯†é‡æ–°ç»„è£…ã€‚
    - æ¯”å¦‚ä¸€æ¬¡è¯·æ±‚çš„ request å’Œ response ä¸¤ä¸ªæ¶ˆæ¯ç»„æˆçš„æµï¼Œä½†æ˜¯æ¯ä¸ªæ¶ˆæ¯åŒ…å«äº† Headerså¸§å’Œ dataå¸§ã€‚
2. å¤šè·¯å¤ç”¨ï¼šæœ‰äº†äºŒè¿›åˆ¶åˆ†å¸§ä¹‹å,ä¸å†ä¾èµ– TCP é“¾æ¥å»å®ç°å¤šæµå¹¶è¡Œ
    - åŒåŸŸåä¸‹æ‰€æœ‰é€šä¿¡éƒ½åœ¨å•ä¸ªè¿æ¥ä¸Šå®Œæˆã€‚
    - å•ä¸ªè¿æ¥å¯ä»¥æ‰¿è½½ä»»æ„æ•°é‡çš„åŒå‘æ•°æ®æµã€‚
    - å¹¶è¡Œäº¤é”™åœ°å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè¯·æ±‚ä¹‹é—´äº’ä¸å½±å“ã€‚
    - å¹¶è¡Œäº¤é”™åœ°å‘é€å¤šä¸ªå“åº”ï¼Œå“åº”ä¹‹é—´äº’ä¸å¹²æ‰°ã€‚
    - æ¯ä¸ªè¯·æ±‚éƒ½å¯ä»¥å¸¦ä¸€ä¸ª 31bit çš„ä¼˜å…ˆå€¼ï¼Œ0 è¡¨ç¤ºæœ€é«˜ä¼˜å…ˆçº§ï¼Œæ•°å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šä½ã€‚
3. Headerå‹ç¼©ï¼šåœ¨ HTTP/1 ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨æ–‡æœ¬çš„å½¢å¼ä¼ è¾“ headerï¼Œåœ¨ header æºå¸¦ cookie çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½æ¯æ¬¡éƒ½éœ€è¦é‡å¤ä¼ è¾“å‡ ç™¾åˆ°å‡ åƒçš„å­—èŠ‚ã€‚
    - åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨â€œé¦–éƒ¨è¡¨â€æ¥è·Ÿè¸ªå’Œå­˜å‚¨ä¹‹å‰å‘é€çš„é”®ï¼å€¼å¯¹ï¼Œå¯¹äºç›¸åŒçš„æ•°æ®ï¼Œä¸å†é€šè¿‡æ¯æ¬¡è¯·æ±‚å’Œå“åº”å‘é€.
    - é¦–éƒ¨è¡¨åœ¨ HTTP/2 çš„è¿æ¥å­˜ç»­æœŸå†…å§‹ç»ˆå­˜åœ¨ï¼Œç”±å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å…±åŒæ¸è¿›åœ°æ›´æ–°.
    - æ¯ä¸ªæ–°çš„é¦–éƒ¨é”®ï¼å€¼å¯¹è¦ä¹ˆè¢«è¿½åŠ åˆ°å½“å‰è¡¨çš„æœ«å°¾ï¼Œè¦ä¹ˆæ›¿æ¢è¡¨ä¸­ä¹‹å‰çš„å€¼.
![é¦–éƒ¨å‹ç¼©](../../assets/img/header_yasuo.png)
4. Server Pushï¼šç±»ä¼¼ prefetch ä½†æ˜¯æ˜¯ç”±æœåŠ¡ç«¯å‘èµ·

### HTTP/3 ï¼ˆQUICï¼‰

ä¸¢åŒ…å¯¼è‡´æ•´ä¸ª TCP é‡ä¼ é˜»å¡

1. 0-RTT
2. å¤šè·¯å¤ç”¨ï¼šåŸç”Ÿæ”¯æŒ å¤šä¸ªæµä¹‹é—´äº’ä¸å½±å“ ä¸ä¼šå› ä¸ºä¸¢åŒ…é‡ä¼ é€ æˆé˜»å¡
3. åŠ å¯†è®¤è¯çš„æŠ¥æ–‡
4. å‘å‰çº é”™æœºåˆ¶

### HTTPS

æ•°æ®æ˜æ–‡ä¼ è¾“ï¼Œéå¸¸å®¹æ˜“è¢«æ”»å‡»è€…è·å–ï¼Œåœ¨tcpä¸‰æ¬¡æ¡æ‰‹åä¼ è¾“æ•°æ®å‰å•†è®®åŠ å¯†åè®®

#### å¯¹ç§°åŠ å¯†
åªæœ‰ä¸€ä¸ª key æ”»å‡»è€…å¯ä»¥æ‹¿åˆ°ï¼Œä¸å®‰å…¨

#### éå¯¹ç§°åŠ å¯†
æˆå¯¹çš„å…¬é’¥å’Œç§é’¥
å®¢æˆ·ç«¯å¯ä»¥æ‹¿åˆ°å…¬é’¥ï¼Œåˆ©ç”¨å…¬é’¥åŠ å¯†æœåŠ¡ç«¯ç§é’¥è§£å¯†ï¼Œåè¿‡æ¥æœåŠ¡ç«¯åªèƒ½ç”¨ç§é’¥åŠ å¯†ï¼Œå®¢æˆ·ç«¯ç”¨ä»…æœ‰çš„å…¬é’¥è§£å¯†ã€‚æ”»å‡»è€…åŒæ ·æœ‰å…¬é’¥å¯ä»¥è§£å¯†æœåŠ¡ç«¯çš„æ•°æ®ã€‚

#### å¯¹ç§°â•éå¯¹ç§°
å…ˆä½¿ç”¨éå¯¹ç§°åŠ å¯†æ²Ÿé€šä¸€ä¸ª key ä½œä¸ºå¯¹ç§°åŠ å¯†çš„ key è¿›è¡ŒåŠ è§£å¯†ã€‚
ä¸­é—´äººæ”»å‡»ï¼šæ‹¦æˆªå®¢æˆ·ç«¯æŠ¥æ–‡ä¼ªè£…æœåŠ¡ç«¯æä¾›è‡ªå·±çš„å…¬é’¥ç»™å®¢æˆ·ç«¯ï¼Œå¹¶å‘æœåŠ¡ç«¯è·å–æ­£ç¡®çš„å…¬é’¥ï¼Œæ‹¦æˆªå®¢æˆ·ç«¯æ•°æ®åˆ©ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†æ•°æ®ã€‚

#### CAæœºæ„
å®¢æˆ·ç«¯ä»å‘æœåŠ¡ç«¯è¯·æ±‚å…¬é’¥æ”¹ä¸ºè¯·æ±‚ licenseï¼Œè¿™æ˜¯æœåŠ¡ç«¯çš„å…¬é’¥(PK)åœ¨ CA æœºæ„ç”¨è‡ªå·±çš„ç§é’¥(CSK)å¯¹PKè¿›è¡ŒåŠ å¯†åå¾—åˆ°çš„ï¼Œå®¢æˆ·ç«¯è‡ªèº«åœ¨æ“ä½œç³»ç»Ÿå­˜å‚¨äº†éå¸¸å¤šçš„CAæœºæ„çš„å…¬é’¥(CPK)ï¼Œåˆ©ç”¨CPKå¯¹licenseè¿›è¡Œè§£å¯†åè·å–åˆ°å®é™…çš„PKï¼Œæ­¤æ—¶ä¸­é—´äººå¦‚æœä¼ªè£…æœåŠ¡ç«¯è¿”å›è‡ªå·±çš„PKä½œä¸ºlicenseä¼šè¢«éªŒè¯ä¸ºä¸å®‰å…¨çš„ï¼Œæ”»å‡»è€…åªèƒ½æ‹¿åˆ°åŠ å¯†æ•°æ®å’Œå®é™…çš„PKæ²¡æœ‰å®é™…çš„ç§é’¥(SK)æ— æ³•å¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚

#### å‰ç«¯æœ¬åœ°ä½¿ç”¨https
```
brew install mkcert
mkcert -install
mkcert local.hao.com

# pwd => /Users/hao/local.hao.com-key.pem

# hosts
127.0.0.1 local.hao.com

# devServer
https: {
  key: './local.hao.com-key.pem',
  cert: './local.hao.com.pem'
}
```

### æµè§ˆå™¨è¯·æ±‚å¹¶å‘
`Chrome`/`Firefox`å•ä¸ªåŸŸååªèƒ½å¹¶å‘è¯·æ±‚ 6 ä¸ªèµ„æºã€‚

1. `Chrome` çš„å¹¶å‘è¯·æ±‚æ•°é‡æ˜¯ä¸èƒ½ä¿®æ”¹çš„ï¼Œå› ä¸ºå·²ç»å›ºå®šå†™åˆ°æºç ä¸­äº†ï¼Œå…·ä½“å¯ä»¥[æŸ¥çœ‹](https://chromium.googlesource.com/chromium/src/+/65.0.3325.162/net/socket/client_socket_pool_manager.cc#44)ã€‚
2. `Firefox` å¯ä»¥ä¿®æ”¹ï¼Œé¦–å…ˆåœ¨åœ°å€æ è¾“å…¥ `about:config`ï¼Œæœç´¢ `http.max` å…³é”®å­—ï¼Œ`network.http.max-connections` ä¸ºå…¨å±€ `HTTP` åŒæ—¶æœ€å¤§çš„è¿æ¥æ•°é‡ï¼Œé»˜è®¤ä¸º `900`ï¼›`network.http.max-persistent-connections-per-server` ä¸ºå•ä¸ªåŸŸåæœ€å¤§é“¾æ¥æ•°é‡ï¼Œé»˜è®¤ä¸º `6`ï¼ŒåŒå‡»æ­¤åˆ—å¯ä»¥è¿›è¡Œä¿®æ”¹ã€‚